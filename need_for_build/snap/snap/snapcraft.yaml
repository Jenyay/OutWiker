name: outwiker
version: '{version}'
summary: Cross-platform software for keeping your notes in a tree
description: |
    OutWiker is a cross-platform software for keeping your notes in a tree.
    Similar programs call "outliner", "tree-like editor" or personal wiki.
    Main difference OutWiker from other programs is a keeping notes as folders on disk.
    A notes can to have attached files. OutWiker can contain pages of different types,
    currently supports three types of pages: plain text, HTML pages and wiki pages.

grade: stable # must be 'stable' to release into candidate/stable channels
confinement: strict # use 'strict' once you have the right plugs and slots
icon: usr/share/icons/outwiker.svg
base: core20

apps:
    outwiker:
        # command: bin/snapcraft-preload $SNAP/usr/bin/outwiker
        # command: bin/snapcraft-preload usr/bin/outwiker
        command: usr/bin/outwiker
        plugs:
            - x11
            - unity7
            - wayland
            - pulseaudio
            - home
            - gsettings
            - network
            - network-bind
            - cups-control
            - desktop
            - desktop-legacy
            - removable-media
            - upower-observe
            - mount-observe
        extensions:
            - gnome-3-38
        desktop: usr/share/applications/outwiker.desktop
        environment:
            LD_LIBRARY_PATH: $SNAP/usr/lib/$SNAPCRAFT_ARCH_TRIPLET/webkit2gtk-4.0/:$SNAP/usr/lib/$SNAPCRAFT_ARCH_TRIPLET/pulseaudio:$SNAP/lib/python3.8/site-packages/hunspell:$LD_LIBRARY_PATH
            #PYTHONPATH: $SNAP/lib/python3.8/site-packages/

parts:
    outwiker:
        # after:
        #     - snapcraft-preload
            # - webkitgtk
        #plugin: nil
        plugin: python
        # python-version: python3
        source: .
        build-environment:
            - SNAPCRAFT_PYTHON_INTERPRETER: python3.8
            - PATH: $SNAPCRAFT_PART_INSTALL/bin:$PATH
            -  PYTHONPATH: ''
            #- PATH: /usr/bin:$PATH
            #- PYTHONPATH: '/usr/lib/python3/dist-packages/:/usr/lib/python3.8/'
        #build-packages:
            # - libhunspell-dev
            #- python3-dev
            #- python3-setuptools
            # - libwebkit2gtk-4.0-dev
            # - python3-dev
            # - libssl-dev
            # - build-essential
            # - libjpeg-dev
            # - libtiff-dev
            # - libsdl2-dev
            # - libgstreamer-plugins-base1.0-dev
            # - libnotify-dev
            # - freeglut3-dev
            # - libsm-dev
            # - libgtk-3-dev
        stage-packages:
            - python3.8
            - python3.8-dev
            #- python3
            #- python3-dev
            #- python3-setuptools
            - libglu1-mesa
            - libsdl2-2.0-0
            - libsndio7.0
            - libxss1
            - freeglut3
            - ibus-gtk3
            - zlib1g
            - libsm6
            - libpulse0
            # - libhunspell-1.7-0
            # - libwebkit2gtk-4.0-37
            - libsdl-gfx1.2-5
            - libgstreamer1.0-0
            - libslang2
            # - libegl1
        python-packages:
          #- wheel==0.36.2
          - https://extras.wxpython.org/wxPython4/extras/linux/gtk3/ubuntu-20.04/wxPython-4.1.1-cp38-cp38-linux_x86_64.whl
          - Pillow==9.1.1
          - cyhunspell==2.0.2
          - idna==3.1
          - pyparsing==3.0.7
        override-build: |
            #echo $PYTHONPATH
            #python3 -m pip install https://extras.wxpython.org/wxPython4/extras/linux/gtk3/ubuntu-20.04/wxPython-4.1.1-cp38-cp38-linux_x86_64.whl
            #python3 -m pip install Pillow==9.1.1 cyhunspell==2.0.2 idna==3.1 pyparsing==3.0.7
            #python3 -m pip list
            rm -rf $SNAPCRAFT_PART_INSTALL/usr/lib/python3.8/distutils
            cp -r /usr/lib/python3.8/distutils $SNAPCRAFT_PART_INSTALL/usr/lib/python3.8/distutils
            #mkdir -p $SNAPCRAFT_PART_INSTALL/usr/include/
            #cp -r /usr/include/python3.9 $SNAPCRAFT_PART_INSTALL/usr/include/python3.9
            snapcraftctl build
            cp -r $SNAPCRAFT_PART_SRC/usr $SNAPCRAFT_PART_INSTALL
            chmod +x $SNAPCRAFT_PART_INSTALL/usr/bin/outwiker

    #outwiker:
    #    # after:
    #    #     - snapcraft-preload
    #        # - webkitgtk
    #    plugin: python
    #    # python-version: python3
    #    source: .
    #    #build-packages:
    #        # - libhunspell-dev
    #        #- python3-dev
    #        #- python3-setuptools
    #        # - libwebkit2gtk-4.0-dev
    #        # - python3-dev
    #        # - libssl-dev
    #        # - build-essential
    #        # - libjpeg-dev
    #        # - libtiff-dev
    #        # - libsdl2-dev
    #        # - libgstreamer-plugins-base1.0-dev
    #        # - libnotify-dev
    #        # - freeglut3-dev
    #        # - libsm-dev
    #        # - libgtk-3-dev
    #    stage-packages:
    #        - python3
    #        - python3-dev
    #        - python3-setuptools
    #        - libglu1-mesa
    #        - libsdl2-2.0-0
    #        - libsndio7.0
    #        - libxss1
    #        - freeglut3
    #        - ibus-gtk3
    #        - zlib1g
    #        - libsm6
    #        - libpulse0
    #        # - libhunspell-1.7-0
    #        # - libwebkit2gtk-4.0-37
    #        - libsdl-gfx1.2-5
    #        - libgstreamer1.0-0
    #        - libslang2
    #        # - libegl1
    #    python-packages:
    #      #- wheel==0.36.2
    #      - https://extras.wxpython.org/wxPython4/extras/linux/gtk3/ubuntu-20.04/wxPython-4.1.1-cp38-cp38-linux_x86_64.whl
    #      - Pillow==9.1.1
    #      - cyhunspell==2.0.2
    #      - idna==3.1
    #      - pyparsing==3.0.7
    #    override-build: |
    #        snapcraftctl build
    #        cp -r $SNAPCRAFT_PART_SRC/usr $SNAPCRAFT_PART_INSTALL
    #        chmod +x $SNAPCRAFT_PART_INSTALL/usr/bin/outwiker

    # snapcraft-preload:
    #     source: https://github.com/sergiusens/snapcraft-preload.git
    #     plugin: cmake
    #     build-packages:
    #       - gcc-multilib
    #       - g++-multilib
    #     stage-packages:
    #       - lib32stdc++6

    # webkitgtk:
    #     plugin: cmake
    #     configflags:
    #         - -DCMAKE_C_COMPILER=clang
    #         - -DCMAKE_CXX_COMPILER=clang++
    #         - -DLIBEXEC_INSTALL_DIR=/usr/libexec/webkit2gtk-4.0
    #         - -DCMAKE_INSTALL_PREFIX=/
    #         - -DCMAKE_BUILD_TYPE=Release
    #         - -DPORT=GTK
    #         # - -DENABLE_WEB_CRYPTO=0
    #         # - -DUSE_OPENJPEG=0
    #         # - -DUSE_WOFF2=0
    #         # - -DUSE_GSTREAMER_GL=0
    #         # - -DENABLE_OPENGL=OFF
    #         # - -DENABLE_ACCELERATED_2D_CANVAS=ON
    #         # - -DENABLE_CSS3_TEXT=ON
    #         # - -DENABLE_CSS_COMPOSITING=ON
    #         # - -DENABLE_CSS_IMAGE_ORIENTATION=ON
    #         - -DENABLE_MINIBROWSER=ON
    #         - -DENABLE_MEDIA_SOURCE=0
    #         - -DUSE_WPE_RENDERER=0
    #         - -DENABLE_BUBBLEWRAP_SANDBOX=0
    #     # source: https://www.webkitgtk.org/releases/webkitgtk-2.28.2.tar.xz
    #     # source: https://www.webkitgtk.org/releases/webkitgtk-2.25.92.tar.xz
    #     # source: https://www.webkitgtk.org/releases/webkitgtk-2.24.1.tar.xz
    #     source: https://jenyay.net/uploads/Outwiker/Dev/webkitgtk-2.28.1.tar.xz
    #     build-packages:
    #         - clang
    #         - ruby
    #         - libgcrypt20-dev
    #         - libwebp-dev
    #         - libxslt1-dev
    #         - libsecret-1-dev
    #         - libtasn1-6-dev
    #         - libenchant-dev
    #         - libhyphen-dev
    #         - libjpeg-dev
    #         - libsoup2.4-dev
    #         - libxkbcommon-dev
    #         - libnghttp2-14
    #         - libpixman-1-dev
    #         - libsqlite3-dev
    #         - libgl1-mesa-dev
    #         - freeglut3-dev 
    #         - libgirepository1.0-dev
    #         - libgtk-3-dev
    #         - libgtk2.0-dev
    #         - libnotify-dev
    #         - libgstreamer1.0-dev
    #         - libgstreamer-plugins-base1.0-dev
    #         - libopenjp2-7-dev
    #         - libwoff-dev
    #         - ninja-build
    #     stage-packages:
    #         - libc6
    #         - libstdc++6
    #         - libgl1
    #         - libgles2
    #         - geoclue-2.0
    #         - gperf
    #         - gobject-introspection
    #         - gettext
    #         - libgtk2.0-0
    #         - libopenjp2-7
    #         - libxt6
